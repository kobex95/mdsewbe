<style>
/* WAF Plus ç°ä»£åŒ–æ ·å¼ */
.waf-plus-container {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f5f7fa;
    min-height: 100vh;
}

/* ä»ªè¡¨æ¿å¡ç‰‡æ ·å¼ */
.dashboard-card {
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    padding: 24px;
    margin-bottom: 24px;
    transition: all 0.3s ease;
}

.dashboard-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(0,0,0,0.12);
}

.card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 16px;
    border-bottom: 1px solid #eee;
}

.card-title {
    font-size: 18px;
    font-weight: 600;
    color: #2d3748;
    display: flex;
    align-items: center;
    gap: 12px;
}

.card-icon {
    width: 36px;
    height: 36px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
}

.icon-shield { background: linear-gradient(135deg, #4299e1, #3182ce); color: white; }
.icon-chart { background: linear-gradient(135deg, #48bb78, #38a169); color: white; }
.icon-alert { background: linear-gradient(135deg, #ed8936, #dd6b20); color: white; }
.icon-server { background: linear-gradient(135deg, #805ad5, #6b46c1); color: white; }

/* ç»Ÿè®¡æ•°å­—æ ·å¼ */
.stat-number {
    font-size: 32px;
    font-weight: 700;
    color: #2d3748;
    margin: 8px 0;
}

.stat-label {
    font-size: 14px;
    color: #718096;
    margin-bottom: 4px;
}

.stat-trend {
    font-size: 12px;
    display: flex;
    align-items: center;
    gap: 4px;
}

.trend-up { color: #48bb78; }
.trend-down { color: #e53e3e; }

/* å›¾è¡¨å®¹å™¨ */
.chart-container {
    height: 300px;
    width: 100%;
}

/* æ§åˆ¶é¢æ¿æŒ‰é’® */
.control-panel {
    display: flex;
    gap: 16px;
    margin-bottom: 24px;
    flex-wrap: wrap;
}

.btn-primary {
    background: linear-gradient(135deg, #4299e1, #3182ce);
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 8px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 8px;
}

.btn-primary:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(66, 153, 225, 0.3);
}

.btn-secondary {
    background: white;
    color: #4a5568;
    border: 1px solid #e2e8f0;
    padding: 12px 24px;
    border-radius: 8px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
}

.btn-secondary:hover {
    background: #f7fafc;
    border-color: #cbd5e0;
}

/* è¡¨æ ¼æ ·å¼ */
.waf-table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}

.waf-table th {
    background: #f7fafc;
    padding: 16px 12px;
    text-align: left;
    font-weight: 600;
    color: #4a5568;
    border-bottom: 1px solid #e2e8f0;
}

.waf-table td {
    padding: 16px 12px;
    border-bottom: 1px solid #f1f5f9;
    color: #4a5568;
}

.waf-table tr:hover {
    background: #f8fafc;
}

.badge {
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 500;
}

.badge-high { background: #fed7d7; color: #c53030; }
.badge-medium { background: #feebc8; color: #c05621; }
.badge-low { background: #c6f6d5; color: #2f855a; }

/* çŠ¶æ€æŒ‡ç¤ºå™¨ */
.status-indicator {
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.status-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
}

.status-active { background: #48bb78; }
.status-inactive { background: #e53e3e; }
.status-warning { background: #ed8936; }

/* æœç´¢æ¡†æ ·å¼ */
.search-box {
    position: relative;
    max-width: 400px;
    margin-bottom: 24px;
}

.search-input {
    width: 100%;
    padding: 12px 48px 12px 16px;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    font-size: 14px;
    transition: all 0.2s ease;
}

.search-input:focus {
    outline: none;
    border-color: #4299e1;
    box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
}

.search-icon {
    position: absolute;
    right: 16px;
    top: 50%;
    transform: translateY(-50%);
    color: #a0aec0;
}

/* åˆ†é¡µæ ·å¼ */
.pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 8px;
    margin-top: 24px;
}

.page-btn {
    padding: 8px 16px;
    border: 1px solid #e2e8f0;
    background: white;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.page-btn:hover {
    background: #f7fafc;
    border-color: #cbd5e0;
}

.page-btn.active {
    background: #4299e1;
    color: white;
    border-color: #4299e1;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
    .dashboard-grid {
        grid-template-columns: 1fr;
    }
    
    .control-panel {
        flex-direction: column;
    }
    
    .card-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
    }
}

/* æš—è‰²ä¸»é¢˜æ”¯æŒ */
.dark-theme {
    background: #1a202c;
    color: #e2e8f0;
}

.dark-theme .dashboard-card {
    background: #2d3748;
    color: #e2e8f0;
}

.dark-theme .waf-table th {
    background: #4a5568;
    color: #e2e8f0;
}

.dark-theme .waf-table td {
    color: #e2e8f0;
    border-bottom-color: #4a5568;
}

/* åŠ¨ç”»æ•ˆæœ */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.fade-in {
    animation: fadeIn 0.5s ease forwards;
}

/* åŠ è½½åŠ¨ç”» */
.loading-spinner {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid #f3f3f3;
    border-top: 3px solid #4299e1;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
</style>

<div class="waf-plus-container">
    <!-- å¯¼èˆªèœå• -->
    <div class="bt-w-menu">
        <p class="bgw" onclick="showDashboard()">ä»ªè¡¨æ¿</p>
        <p onclick="showAttackLogs()">æ”»å‡»æ—¥å¿—</p>
        <p onclick="showRules()">è§„åˆ™ç®¡ç†</p>
        <p onclick="showThreatIntel()">å¨èƒæƒ…æŠ¥</p>
        <p onclick="showSettings()">ç³»ç»Ÿè®¾ç½®</p>
    </div>
    
    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <div class="bt-w-con pd15">
        <div class="soft-man-con">
            <!-- ä»ªè¡¨æ¿å†…å®¹ -->
            <div id="dashboard-view" class="fade-in">
                <!-- æ§åˆ¶é¢æ¿ -->
                <div class="control-panel">
                    <button class="btn-primary" onclick="toggleWaf()">
                        <i class="fas fa-power-off"></i>
                        <span id="waf-status-text">å¯ç”¨WAF</span>
                    </button>
                    <button class="btn-secondary" onclick="refreshDashboard()">
                        <i class="fas fa-sync-alt"></i>
                        åˆ·æ–°æ•°æ®
                    </button>
                    <button class="btn-secondary" onclick="exportReports()">
                        <i class="fas fa-download"></i>
                        å¯¼å‡ºæŠ¥å‘Š
                    </button>
                </div>
                
                <!-- ç»Ÿè®¡å¡ç‰‡ç½‘æ ¼ -->
                <div class="dashboard-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 24px; margin-bottom: 24px;">
                    <!-- æ”»å‡»æ‹¦æˆªç»Ÿè®¡ -->
                    <div class="dashboard-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon icon-shield">ğŸ›¡ï¸</div>
                                æ”»å‡»æ‹¦æˆª
                            </div>
                            <div class="status-indicator">
                                <div class="status-dot status-active"></div>
                                <span>è¿è¡Œä¸­</span>
                            </div>
                        </div>
                        <div class="stat-number" id="attack-count">1,247</div>
                        <div class="stat-label">ä»Šæ—¥æ‹¦æˆªæ”»å‡»</div>
                        <div class="stat-trend trend-up">
                            <i class="fas fa-arrow-up"></i>
                            <span>+12.5% è¾ƒæ˜¨æ—¥</span>
                        </div>
                    </div>
                    
                    <!-- å®æ—¶è¿æ¥æ•° -->
                    <div class="dashboard-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon icon-server">ğŸŒ</div>
                                å®æ—¶è¿æ¥
                            </div>
                        </div>
                        <div class="stat-number" id="connection-count">156</div>
                        <div class="stat-label">å½“å‰æ´»è·ƒè¿æ¥</div>
                        <div class="stat-trend trend-down">
                            <i class="fas fa-arrow-down"></i>
                            <span>-3.2% è¾ƒä¸Šå°æ—¶</span>
                        </div>
                    </div>
                    
                    <!-- QPSç»Ÿè®¡ -->
                    <div class="dashboard-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon icon-chart">ğŸ“Š</div>
                                è¯·æ±‚å¤„ç†
                            </div>
                        </div>
                        <div class="stat-number" id="qps-count">1,247</div>
                        <div class="stat-label">å½“å‰QPS</div>
                        <div class="stat-trend trend-up">
                            <i class="fas fa-arrow-up"></i>
                            <span>+8.7% è¾ƒä¸Šå°æ—¶</span>
                        </div>
                    </div>
                    
                    <!-- æ‹¦æˆªIPæ•° -->
                    <div class="dashboard-card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon icon-alert">ğŸš¨</div>
                                æ¶æ„IP
                            </div>
                        </div>
                        <div class="stat-number" id="blocked-ip-count">23</div>
                        <div class="stat-label">ä»Šæ—¥å°ç¦IP</div>
                        <div class="stat-trend trend-down">
                            <i class="fas fa-arrow-down"></i>
                            <span>-5.1% è¾ƒæ˜¨æ—¥</span>
                        </div>
                    </div>
                </div>
                
                <!-- å›¾è¡¨åŒºåŸŸ -->
                <div class="dashboard-grid" style="grid-template-columns: 2fr 1fr; gap: 24px;">
                    <!-- æ”»å‡»è¶‹åŠ¿å›¾ -->
                    <div class="dashboard-card">
                        <div class="card-header">
                            <div class="card-title">æ”»å‡»è¶‹åŠ¿</div>
                        </div>
                        <div class="chart-container" id="attack-trend-chart"></div>
                    </div>
                    
                    <!-- å¨èƒæƒ…æŠ¥ -->
                    <div class="dashboard-card">
                        <div class="card-header">
                            <div class="card-title">å¨èƒæƒ…æŠ¥</div>
                        </div>
                        <div id="threat-intel-list">
                            <!-- åŠ¨æ€åŠ è½½å¨èƒæƒ…æŠ¥æ•°æ® -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- æ”»å‡»æ—¥å¿—è§†å›¾ -->
            <div id="logs-view" style="display: none;" class="fade-in">
                <div class="dashboard-card">
                    <div class="card-header">
                        <div class="card-title">æ”»å‡»æ—¥å¿—</div>
                        <div class="search-box">
                            <input type="text" class="search-input" id="log-search" placeholder="æœç´¢IPã€è§„åˆ™æˆ–URI...">
                            <i class="fas fa-search search-icon"></i>
                        </div>
                    </div>
                    
                    <table class="waf-table">
                        <thead>
                            <tr>
                                <th>æ—¶é—´</th>
                                <th>IPåœ°å€</th>
                                <th>æ”»å‡»ç±»å‹</th>
                                <th>URI</th>
                                <th>é£é™©ç­‰çº§</th>
                                <th>å¤„ç†åŠ¨ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="logs-table-body">
                            <!-- åŠ¨æ€åŠ è½½æ—¥å¿—æ•°æ® -->
                        </tbody>
                    </table>
                    
                    <div class="pagination" id="logs-pagination">
                        <!-- åŠ¨æ€ç”Ÿæˆåˆ†é¡µ -->
                    </div>
                </div>
            </div>
            
            <!-- è§„åˆ™ç®¡ç†è§†å›¾ -->
            <div id="rules-view" style="display: none;" class="fade-in">
                <div class="dashboard-card">
                    <div class="card-header">
                        <div class="card-title">é˜²æŠ¤è§„åˆ™</div>
                        <button class="btn-primary" onclick="addNewRule()">
                            <i class="fas fa-plus"></i>
                            æ·»åŠ è§„åˆ™
                        </button>
                    </div>
                    
                    <table class="waf-table">
                        <thead>
                            <tr>
                                <th>è§„åˆ™åç§°</th>
                                <th>ç±»å‹</th>
                                <th>ä¼˜å…ˆçº§</th>
                                <th>çŠ¶æ€</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="rules-table-body">
                            <!-- åŠ¨æ€åŠ è½½è§„åˆ™æ•°æ® -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- è®¾ç½®è§†å›¾ -->
            <div id="settings-view" style="display: none;" class="fade-in">
                <div class="dashboard-grid" style="grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 24px;">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <div class="card-title">åŸºæœ¬è®¾ç½®</div>
                        </div>
                        <form id="basic-settings-form">
                            <div style="margin-bottom: 16px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 500;">WAFçŠ¶æ€</label>
                                <select class="form-control" name="waf_enabled">
                                    <option value="true">å¯ç”¨</option>
                                    <option value="false">ç¦ç”¨</option>
                                </select>
                            </div>
                            
                            <div style="margin-bottom: 16px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 500;">æ—¥å¿—çº§åˆ«</label>
                                <select class="form-control" name="log_level">
                                    <option value="debug">è°ƒè¯•</option>
                                    <option value="info" selected>ä¿¡æ¯</option>
                                    <option value="warn">è­¦å‘Š</option>
                                    <option value="error">é”™è¯¯</option>
                                </select>
                            </div>
                            
                            <div style="margin-bottom: 16px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 500;">æ‹¦æˆªåŠ¨ä½œ</label>
                                <select class="form-control" name="block_action">
                                    <option value="403">è¿”å›403</option>
                                    <option value="404">è¿”å›404</option>
                                    <option value="redirect">é‡å®šå‘</option>
                                </select>
                            </div>
                            
                            <button type="submit" class="btn-primary">ä¿å­˜è®¾ç½®</button>
                        </form>
                    </div>
                    
                    <div class="dashboard-card">
                        <div class="card-header">
                            <div class="card-title">æ€§èƒ½è®¾ç½®</div>
                        </div>
                        <form id="performance-settings-form">
                            <div style="margin-bottom: 16px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 500;">é€Ÿç‡é™åˆ¶ (QPS)</label>
                                <input type="number" class="form-control" name="rate_limit" value="1000" min="1" max="10000">
                            </div>
                            
                            <div style="margin-bottom: 16px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 500;">ç¼“å­˜å¤§å° (MB)</label>
                                <input type="number" class="form-control" name="cache_size" value="50" min="10" max="500">
                            </div>
                            
                            <div style="margin-bottom: 16px;">
                                <label style="display: block; margin-bottom: 8px; font-weight: 500;">
                                    <input type="checkbox" name="learning_mode"> å­¦ä¹ æ¨¡å¼
                                </label>
                                <small style="color: #718096;">ä»…è®°å½•ä¸æ‹¦æˆªï¼Œç”¨äºè§„åˆ™è°ƒä¼˜</small>
                            </div>
                            
                            <button type="submit" class="btn-primary">ä¿å­˜è®¾ç½®</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="/plugins/file?name=waf_plus&f=js/waf_plus.js"></script>
<script>
// é¡µé¢åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
    // é»˜è®¤æ˜¾ç¤ºä»ªè¡¨æ¿
    showDashboard();
    
    // ç»‘å®šæœç´¢äº‹ä»¶
    document.getElementById('log-search').addEventListener('input', debounce(searchLogs, 500));
    
    // ç»‘å®šè¡¨å•æäº¤äº‹ä»¶
    document.getElementById('basic-settings-form').addEventListener('submit', saveBasicSettings);
    document.getElementById('performance-settings-form').addEventListener('submit', savePerformanceSettings);
});

// é˜²æŠ–å‡½æ•°
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// è§†å›¾åˆ‡æ¢å‡½æ•°
function showDashboard() {
    hideAllViews();
    document.getElementById('dashboard-view').style.display = 'block';
    loadDashboardData();
}

function showAttackLogs() {
    hideAllViews();
    document.getElementById('logs-view').style.display = 'block';
    loadAttackLogs();
}

function showRules() {
    hideAllViews();
    document.getElementById('rules-view').style.display = 'block';
    loadRules();
}

function showThreatIntel() {
    hideAllViews();
    // å¨èƒæƒ…æŠ¥è§†å›¾é€»è¾‘
}

function showSettings() {
    hideAllViews();
    document.getElementById('settings-view').style.display = 'block';
    loadSettings();
}

function hideAllViews() {
    const views = ['dashboard-view', 'logs-view', 'rules-view', 'settings-view'];
    views.forEach(viewId => {
        document.getElementById(viewId).style.display = 'none';
    });
}

// APIè°ƒç”¨å‡½æ•°
async function wafPlusPost(method, args = {}) {
    try {
        const response = await fetch('/plugins/run', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                name: 'waf_plus',
                func: method,
                args: JSON.stringify(args)
            })
        });
        
        const data = await response.json();
        if (!data.status) {
            throw new Error(data.msg);
        }
        return data;
    } catch (error) {
        console.error('APIè°ƒç”¨å¤±è´¥:', error);
        throw error;
    }
}

// æ•°æ®åŠ è½½å‡½æ•°
async function loadDashboardData() {
    try {
        showLoading(true);
        const data = await wafPlusPost('dashboard');
        renderDashboard(data.data);
        showLoading(false);
    } catch (error) {
        showError('åŠ è½½ä»ªè¡¨æ¿æ•°æ®å¤±è´¥: ' + error.message);
        showLoading(false);
    }
}

async function loadAttackLogs(page = 1, pageSize = 20, search = '') {
    try {
        showLoading(true);
        const data = await wafPlusPost('logs', { page, page_size: pageSize, search });
        renderAttackLogs(data.data);
        showLoading(false);
    } catch (error) {
        showError('åŠ è½½æ”»å‡»æ—¥å¿—å¤±è´¥: ' + error.message);
        showLoading(false);
    }
}

async function loadRules() {
    try {
        showLoading(true);
        const data = await wafPlusPost('rules');
        renderRules(data.data);
        showLoading(false);
    } catch (error) {
        showError('åŠ è½½è§„åˆ™å¤±è´¥: ' + error.message);
        showLoading(false);
    }
}

// æ¸²æŸ“å‡½æ•°
function renderDashboard(data) {
    // æ›´æ–°ç»Ÿè®¡æ•°å­—
    document.getElementById('attack-count').textContent = formatNumber(data.real_time_stats.recent_attacks);
    document.getElementById('connection-count').textContent = data.real_time_stats.active_connections;
    document.getElementById('qps-count').textContent = formatNumber(data.real_time_stats.current_qps);
    document.getElementById('blocked-ip-count').textContent = data.real_time_stats.blocked_ips;
    
    // æ¸²æŸ“æ”»å‡»è¶‹åŠ¿å›¾
    renderAttackTrendChart(data.attack_trends);
    
    // æ¸²æŸ“å¨èƒæƒ…æŠ¥
    renderThreatIntel(data.threat_intel);
}

function renderAttackLogs(data) {
    const tbody = document.getElementById('logs-table-body');
    tbody.innerHTML = '';
    
    data.logs.forEach(log => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${formatDateTime(log.attack_time)}</td>
            <td>${log.ip}</td>
            <td>${log.rule_name}</td>
            <td class="td3txt">${log.uri || '-'}</td>
            <td><span class="badge badge-${log.risk_level}">${log.risk_level}</span></td>
            <td>${log.action_taken}</td>
        `;
        tbody.appendChild(row);
    });
    
    // æ¸²æŸ“åˆ†é¡µ
    renderPagination(data.total, data.page, data.pages, data.page_size);
}

function renderRules(rules) {
    const tbody = document.getElementById('rules-table-body');
    tbody.innerHTML = '';
    
    rules.forEach(rule => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${rule.name}</td>
            <td>${rule.type}</td>
            <td>${rule.priority}</td>
            <td>
                <span class="status-indicator">
                    <div class="status-dot ${rule.status === 'enabled' ? 'status-active' : 'status-inactive'}"></div>
                    ${rule.status === 'enabled' ? 'å¯ç”¨' : 'ç¦ç”¨'}
                </span>
            </td>
            <td>
                <button class="btn-secondary" onclick="editRule(${rule.id})">ç¼–è¾‘</button>
                <button class="btn-secondary" onclick="deleteRule(${rule.id})">åˆ é™¤</button>
            </td>
        `;
        tbody.appendChild(row);
    });
}

// å·¥å…·å‡½æ•°
function formatNumber(num) {
    return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
}

function formatDateTime(timestamp) {
    const date = new Date(timestamp * 1000);
    return date.toLocaleString('zh-CN');
}

function showLoading(show) {
    // æ˜¾ç¤º/éšè—åŠ è½½åŠ¨ç”»
}

function showError(message) {
    // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
}

function showSuccess(message) {
    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
}

// æœç´¢å’Œåˆ†é¡µ
function searchLogs() {
    const searchTerm = document.getElementById('log-search').value;
    loadAttackLogs(1, 20, searchTerm);
}

function renderPagination(total, currentPage, totalPages, pageSize) {
    const pagination = document.getElementById('logs-pagination');
    pagination.innerHTML = '';
    
    // ä¸Šä¸€é¡µ
    if (currentPage > 1) {
        const prevBtn = document.createElement('button');
        prevBtn.className = 'page-btn';
        prevBtn.textContent = 'ä¸Šä¸€é¡µ';
        prevBtn.onclick = () => loadAttackLogs(currentPage - 1, pageSize);
        pagination.appendChild(prevBtn);
    }
    
    // é¡µç 
    for (let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) {
        const pageBtn = document.createElement('button');
        pageBtn.className = `page-btn ${i === currentPage ? 'active' : ''}`;
        pageBtn.textContent = i;
        pageBtn.onclick = () => loadAttackLogs(i, pageSize);
        pagination.appendChild(pageBtn);
    }
    
    // ä¸‹ä¸€é¡µ
    if (currentPage < totalPages) {
        const nextBtn = document.createElement('button');
        nextBtn.className = 'page-btn';
        nextBtn.textContent = 'ä¸‹ä¸€é¡µ';
        nextBtn.onclick = () => loadAttackLogs(currentPage + 1, pageSize);
        pagination.appendChild(nextBtn);
    }
}

// å›¾è¡¨æ¸²æŸ“ï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼‰
function renderAttackTrendChart(trends) {
    const chartContainer = document.getElementById('attack-trend-chart');
    chartContainer.innerHTML = '<div style="height:100%;display:flex;align-items:center;justify-content:center;color:#718096;">å›¾è¡¨åŠ è½½ä¸­...</div>';
    
    // è¿™é‡Œåº”è¯¥ä½¿ç”¨çœŸæ­£çš„å›¾è¡¨åº“å¦‚ECharts
    setTimeout(() => {
        chartContainer.innerHTML = `
            <div style="height:100%;display:flex;flex-direction:column;justify-content:space-around;padding:20px;">
                ${trends.map((trend, index) => `
                    <div style="display:flex;align-items:center;gap:12px;">
                        <div style="font-size:12px;color:#718096;width:80px;">${trend.date}</div>
                        <div style="flex:1;height:20px;background:#e2e8f0;border-radius:10px;overflow:hidden;">
                            <div style="height:100%;width:${(trend.attacks / 200) * 100}%;background:linear-gradient(90deg,#4299e1,#3182ce);border-radius:10px;"></div>
                        </div>
                        <div style="font-size:12px;color:#4a5568;width:60px;">${trend.attacks}</div>
                    </div>
                `).join('')}
            </div>
        `;
    }, 1000);
}

function renderThreatIntel(intel) {
    const intelList = document.getElementById('threat-intel-list');
    intelList.innerHTML = `
        <div style="padding:16px 0;">
            <div style="margin-bottom:16px;">
                <div style="font-weight:500;margin-bottom:8px;">ä»Šæ—¥æ¶æ„IP</div>
                <div style="font-size:24px;font-weight:700;color:#e53e3e;">${intel.malicious_ips_today}</div>
            </div>
            <div style="margin-bottom:16px;">
                <div style="font-weight:500;margin-bottom:8px;">æ–°å¢å¨èƒ</div>
                <div style="font-size:24px;font-weight:700;color:#ed8936;">${intel.new_threats_detected}</div>
            </div>
            <div>
                <div style="font-weight:500;margin-bottom:8px;">é«˜å±å›½å®¶</div>
                <div style="display:flex;gap:8px;flex-wrap:wrap;">
                    ${intel.high_risk_countries.map(country => 
                        `<span style="background:#fed7d7;color:#c53030;padding:4px 8px;border-radius:12px;font-size:12px;">${country}</span>`
                    ).join('')}
                </div>
            </div>
        </div>
    `;
}
</script>